<div id="application"> 
  <!-- Vertical Nav -->
  <%= render 'student/navigation/vertical_navbar' %>
  <% show_explanation = !@answers.nil? %>
  <!-- Content -->
  <div id="container">
    <% 
      qs = 0
      target = ""
      met = ""
      met = :put
      target = student_course_test_course_user_test_path unless @course_user_test.completed?
    %>
    <%= form_tag target, :method => met do %>
    <!-- Clues Mobile-->
    <div class="test-time-wrapper-mobile">
      <div class="test-title-wrapper">
        <h1> Tiempo Restante </h1>
      </div>  
      <div class="test-clue-content-wrapper">
        <!-- Time -->
        <div class="test-clock">
          <b><span class="fa fa-clock-o"></span> Tiempo:</b> <span id=""><span id="hour_mobile"><%= @course_user_test.hour_left %></span>:<span id="min_mobile"><%= @course_user_test.min_left %></span>:<span id="sec_mobile"><%= @course_user_test.sec_left %></span></span> 
        </div>
        <div>
          <button class="btn btn-warning simulator-btn" onclick=""><span class="fa fa-pause"></span> Pausar</button>
          <button class="btn btn-success simulator-btn" onclick=""><span class="fa fa-check-square-o"></span> Calificar</button>
          <button class="btn btn-info simulator-btn" onclick=""><span class="fa fa-home"></span>Menú</button>
        </div>
        <!-- CLues -->
        <div class="row">
          <div class=" simulator-clue">1</div>
          <div class=" simulator-clue">2</div>
          <div class=" simulator-clue">3</div>
          <div class=" simulator-clue">4</div>
          <div class=" simulator-clue">5</div>
        </div>
        <div class="row">
          <div class=" simulator-clue">6</div>
          <div class=" simulator-clue">7</div>
          <div class=" simulator-clue">8</div>
          <div class=" simulator-clue">9</div>
          <div class=" simulator-clue">10</div>
        </div>
        <div class="visual-colored-clues row">
          <ul>
            <div>
              <span class="visual-clue answered"></span><li class="list-simulator-clue">Respondida</li>
            </div>
            <div>
              <span class="visual-clue later"></span><li class="list-simulator-clue">Despues</li>
            </div>
            <div>
              <span class="visual-clue no-answer"></span><li class="list-simulator-clue">Sin respuesta</li>
            </div>
          </ul>

        </div>

      </div>
    </div>
    <!-- Content Homework Progress-->
    <div class="test-inner-wrapper">
      <div class="test-title-wrapper">
        <h1> <%= @course_user_test.test.title %> </h1>
      </div>
        
      <div class="test-content-wrapper">
        <div class=" row rox-fix">
          <!-- Question --> 
          <% @course_user_test.test.questions.each do |q| %>
            <div class="test-question">
              <div class="remind-later"> 
                <label> 
                  <input name="simulator_answered_question[marked_status]" type="hidden" value="unmarked">
                  <input class="simulator-ajax-submittable" data-form="simulator-42-question-2008" type="checkbox" value="marked" name="simulator_answered_question[marked_status]" id="simulator_answered_question_marked_status"> Responder luego
                </label>
              </div>
              <p><%= q.content %></p>
              <% if @answers
                  wrong = true if @answers.where(question_id: q.id).first.choice_id != q.choice_id
                end %>
              <% if q.picture.present? %>
                <%= image_tag(q.picture, class: "img-responsive", alt: q.content) %>
              <% end %>
              <% if q.explanation && show_explanation %>
                <p class="lead explanation">
                  <%= q.explanation %>
                </p>
              <% end %>
              <% if q.url %>
                <%= link_to q.url, q.url %>
              <% end %>
              <% if q.questions %>
                <% q.questions.each do |qs| %>
                  <!-- <hr style="width:80%"> -->
                  <div class="test-question">
                    <p><%= q.content %></p>
                    <% if qs.picture.present? %>
                      <%= image_tag(qs.picture, class: "img-responsive", alt: qs.content) %>
                    <% end %>
                    <% if @answers %>
                      <p class="lead">
                        <%= qs.explanation %>
                      </p>
                    <% end %>
                    <% if qs.url %>
                      <%= link_to qs.url, qs.url %>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
              <% if q.choices %>
                <% 
                letters = ("A".."Z").to_a
                lpos = 0
                %>
                <% q.choices.each do |c| %>
                  <%
                  cl = ""
                  st = ""
                  ch = @course_user_test.answers.find_by(question: q, choice: c) ? true : false
                  %>
                  <% if @answers %>
                    <% if @answers.where(question_id: q.id).first.choice_id == c.id %>
                      <% ch = true %>
                      <% if wrong %>
                        <% cl = "has-error"
                           st = "border: thin solid red" %>
                      <% else %>
                        <% cl = "has-success"
                           st = "border: thin solid green" %>
                      <% end %>
                    <% end %>
                  <% end %>
                  <label class="coolbox <%= cl %>">
                      <%= radio_button_tag "course_user_test[question_ids[#{q.id}]]", c.id, ch %>
                      <span class="box-number"> <%= letters[lpos] %> </span>
                      <span class="box-info"> <%= c.content %> </span>
                      <% if @answers %>
                        <% if @answers.where(question_id: q.id).first.choice_id == c.id %>
                          <% if wrong %>
                            <span class="text-danger">
                              * Error
                            </span>
                          <% end %>
                        <% end %>
                      <% #end %>
                    <% end %>
                  </label>
                  <% lpos += 1 %>
                <% end %>
              <% end %>
              <% -qs+=1 %>
            </div>
          <% end %>
          <%# button_tag 'Pausar', name: "course_user_test[action_form]", value: "pause", class: 'btn btn-primary submit' , type: :submit unless @course_user_test.completed? %>
          <%# button_tag 'Calificar', name: "course_user_test[action_form]", value: "end", class: 'btn btn-primary submit' , type: :submit unless @course_user_test.completed? %>
          <input type="hidden" value="<%= @course_user.id %>" name="course_user_test[course_user_id]">
          <input type="hidden" value="<%= @test.id %>" name="course_user_test[test_id]">
        </div>  
      </div>
    </div>
    <!-- Clues -->
    <div class="test-time-wrapper">
      <div class="test-title-wrapper">
        <h1> Tiempo Restante </h1>
      </div>  
      <div class="test-clue-content-wrapper">

        <!-- Time -->
        <div class="test-clock">
          <b><span class="fa fa-clock-o"></span> Tiempo:</b> <span id=""><span id="hour"><%= @course_user_test.hour_left %></span>:<span id="min"><%= @course_user_test.min_left %></span>:<span id="sec"><%= @course_user_test.sec_left %></span></span> 
        </div>
        <div>
          <%= button_tag(type: 'submit', class: 'btn btn-warning simulator-btn', value: "pause", name: "course_user_test[action_form]") do
                content_tag(:span, '', class:'fa fa-pause') << content_tag(:span, ' Pausar')
              end  unless @course_user_test.completed?
          %>
          <%= button_tag(type: 'submit', class: 'btn btn-success simulator-btn', value: "end", name: "course_user_test[action_form]") do
                content_tag(:span, '', class:'fa fa-check-square-o') << content_tag(:span, ' Calificar')
              end  unless @course_user_test.completed?
          %>
          <button class="btn btn-info simulator-btn" onclick=""><span class="fa fa-home"></span> Menú</button>
        </div>
        <!-- CLues -->
        <div class="row">
          <div class=" simulator-clue">1</div>
          <div class=" simulator-clue">2</div>
          <div class=" simulator-clue">3</div>
          <div class=" simulator-clue">4</div>
          <div class=" simulator-clue">5</div>
        </div>
        <div class="row">
          <div class=" simulator-clue">6</div>
          <div class=" simulator-clue">7</div>
          <div class=" simulator-clue">8</div>
          <div class=" simulator-clue">9</div>
          <div class=" simulator-clue">10</div>
        </div>
        <div class="visual-colored-clues row">
          <ul>
            <div>
              <span class="visual-clue answered"></span><li class="list-simulator-clue">Respondida</li>
            </div>
            <div>
              <span class="visual-clue later"></span><li class="list-simulator-clue">Despues</li>
            </div>
            <div>
              <span class="visual-clue no-answer"></span><li class="list-simulator-clue">Sin respuesta</li>
            </div>
          </ul>

        </div>

      </div>
    </div>
    <% end %>
  </div>
</div>
<script>
  var hour = parseInt("<%= @course_user_test.hour_left %>");
  var min = parseInt("<%= @course_user_test.min_left %>");
  var sec = parseInt("<%= @course_user_test.sec_left %>");
  var interval = setInterval(function() {
      sec--;
      if (sec == 0 && min > 0) {
        sec = 59;
        min--;
        if (min == 0 && hour > 0)
        {
          min = 59;

          hour--;
        }
      }
      if (hour==0 && min==0 && sec==0)
      {
        stopInterval();
        window.location = "<%= student_course_tests_path(@course) %>";
      }

    
      if (String(hour).length == 1)
        $("#hour, #hour_mobile").html("0"+hour);
      else
        $("#hour, #hour_mobile").html(hour);

      if (String(min).length == 1)
        $("#min, #min_mobile").html("0"+min);
      else
        $("#min, #min_mobile").html(min);

      if (String(sec).length == 1)
        $("#sec, #sec_mobile").html("0"+sec);
      else
        $("#sec, #sec_mobile").html(sec);

  }, 1000);

  function stopInterval() 
  {
    clearInterval(interval);
    interval = null;
  }
  // window.addEventListener("beforeunload", function (e) {

  //   (e || window.event).returnValue = true; //Gecko + IE
  //   return true;                            //Webkit, Safari, Chrome
  // });
</script>
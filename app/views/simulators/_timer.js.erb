<script>
  var testTimeUp = function(){
    window.removeEventListener('beforeunload', listener, false);
    $("#finishTimerBtn").click();
  }

  $("#pauseLink").click(function() {
    if ($(this).data('status').toLowerCase() === "pause") {
      $(this).data('status', 'resume')
      window.removeEventListener('beforeunload', listener, false);
      $("#submitTimerBtn").click();
    } else {
      $(this).data('status', 'pause')
    }
    $("#pauseTimerBtn").click();
  })

  $(".btn.pauseSimulator").on('click', function(){
    $("#pauseTimerBtn").click();
  })


  var inFormOrLink;
  $('a').on('click', function() { inFormOrLink = true; });
  $('form').bind('submit', function() { inFormOrLink = true; });

  $(window).on("beforeunload", function() {
    $("#submitTimerBtn").click()
    var close = inFormOrLink ? '' : "Do you really want to close?"  ;
    return "You are currently on a simulator."
  })

  $(window).on("unload", function(){
    window.removeEventListener('beforeunload', listener, false);
  })

  <% if @simulator %>
    var hours_left = '<%= @simulator.time_left.hour %>'
    var minutes_left = '<%= @simulator.time_left.min %>'
    var seconds_left = '<%= @simulator.time_left.sec %>'
    $("#countDownTimer").countdowntimer({
      hours: hours_left,
      minutes: minutes_left,
      seconds: seconds_left,
      size : "lg",
      pauseButton : "pauseTimerBtn",
      timeUp: testTimeUp
    });
  <% end %>
</script>

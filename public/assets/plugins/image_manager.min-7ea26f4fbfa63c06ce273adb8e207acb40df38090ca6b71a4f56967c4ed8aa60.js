!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";if(e.extend(e.FE.DEFAULTS,{imageManagerLoadURL:"https://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:"",imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),e.FE.PLUGINS.imageManager=function(t){function n(){x||s(),x.data("instance",t),x.show(),F.show(),V=t.image.get(),C||E(),l(),t.$doc.find("body").addClass("prevent-scroll"),t.helpers.isMobile()&&t.$doc.find("body").addClass("fr-mobile")}function i(){var e=x.data("instance")||t;e.events.enableBlur(),x.hide(),F.hide(),e.$doc.find("body").removeClass("prevent-scroll fr-mobile")}function o(){var t=e(window).outerWidth();return 768>t?2:1200>t?3:4}function a(){M.empty();for(var e=0;$>e;e++)M.append('<div class="fr-list-column"></div>')}function r(){var n="";t.opts.theme&&(n=" "+t.opts.theme+"-theme");var i='<div class="fr-modal'+n+'"><div class="fr-modal-wrapper">';return i+='<div class="fr-modal-title"><div class="fr-modal-title-line"><i class="fa fa-bars fr-modal-more fr-not-available" id="fr-modal-more-'+t.sid+'" title="'+t.language.translate("Tags")+'"></i><h4 data-text="true">'+t.language.translate("Manage Images")+'</h4><i title="'+t.language.translate("Cancel")+'" class="fa fa-times fr-modal-close" id="fr-modal-close"></i></div>',i+='<div class="fr-modal-tags" id="fr-modal-tags"></div>',i+="</div>",i+='<img class="fr-preloader" id="fr-preloader" alt="'+t.language.translate("Loading")+'.." src="'+t.opts.imageManagerPreloader+'" style="display: none;">',i+='<div class="fr-scroller" id="fr-scroller"><div class="fr-image-list" id="fr-image-list"></div></div>',i+="</div></div>",e(i)}function s(){t.shared.$modal?(x=t.shared.$modal,F=t.shared.$overlay):(t.shared.$modal=r(),x=t.shared.$modal,t.helpers.isMobile()||x.addClass("fr-desktop"),x.appendTo("body"),t.shared.$overlay=e('<div class="fr-overlay">').appendTo("body"),F=t.shared.$overlay,t.opts.theme&&F.addClass(t.opts.theme+"-theme"),i()),t.events.on("shared.destroy",function(){x.removeData().remove(),F.removeData().remove()},!0)}function l(){C.show(),M.find(".fr-list-column").empty(),t.opts.imageManagerLoadURL?e.ajax({url:t.opts.imageManagerLoadURL,method:t.opts.imageManagerLoadMethod,data:t.opts.imageManagerLoadParams,dataType:"json",crossDomain:t.opts.requestWithCORS,xhrFields:{withCredentials:t.opts.requestWithCORS},headers:t.opts.requestHeaders}).done(function(e,n,i){t.events.trigger("imageManager.imagesLoaded",[e]),d(e,i.response),C.hide()}).fail(function(){var e=this.xhr();b(H,e.response||e.responseText)}):b(j)}function d(e,t){try{M.find(".fr-list-column").empty(),I=0,O=0,R=0,N=e,c()}catch(e){b(z,t)}}function c(){if(O<N.length&&(M.outerHeight()<=L.outerHeight()+t.opts.imageManagerScrollOffset||L.scrollTop()+t.opts.imageManagerScrollOffset>M.outerHeight()-L.outerHeight())){I++;for(var e=t.opts.imageManagerPageSize*(I-1);e<Math.min(N.length,t.opts.imageManagerPageSize*I);e++)u(N[e])}}function u(n){var i=new Image,o=e('<div class="fr-image-container fr-empty fr-image-'+R++ +'" data-loading="'+t.language.translate("Loading")+'.." data-deleting="'+t.language.translate("Deleting")+'..">');m(!1),i.onload=function(){o.height(Math.floor(o.width()/i.width*i.height));var a=e("<img/>");if(n.thumb)a.attr("src",n.thumb);else{if(b(B,n),!n.url)return b(Y,n),!1;a.attr("src",n.url)}if(n.url&&a.attr("data-url",n.url),n.tag)if(D.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),D.find(".fr-modal-tags").show(),n.tag.indexOf(",")>=0){for(var r=n.tag.split(","),s=0;s<r.length;s++)r[s]=r[s].trim(),0===A.find('a[title="'+r[s]+'"]').length&&A.append('<a role="button" title="'+r[s]+'">'+r[s]+"</a>");a.attr("data-tag",r.join())}else 0===A.find('a[title="'+n.tag.trim()+'"]').length&&A.append('<a role="button" title="'+n.tag.trim()+'">'+n.tag.trim()+"</a>"),a.attr("data-tag",n.tag.trim());for(var l in n)n.hasOwnProperty(l)&&"thumb"!=l&&"url"!=l&&"tag"!=l&&a.attr("data-"+l,n[l]);o.append(a).append(e(t.icon.create("imageManagerDelete")).addClass("fr-delete-img").attr("title",t.language.translate("Delete"))).append(e(t.icon.create("imageManagerInsert")).addClass("fr-insert-img").attr("title",t.language.translate("Insert"))),A.find(".fr-selected-tag").each(function(e,t){S(a,t.text)||o.hide()}),a.on("load",function(){o.removeClass("fr-empty"),o.height("auto"),O++;var e=f(parseInt(a.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);p(e),m(!1),O%t.opts.imageManagerPageSize===0&&c()}),t.events.trigger("imageManager.imageLoaded",[a])},i.onerror=function(){O++,o.remove();var e=f(parseInt(o.attr("class").match(/fr-image-(\d+)/)[1],10)+1);p(e),b(P,n),O%t.opts.imageManagerPageSize===0&&c()},i.src=n.url,h().append(o)}function h(){var t,n;return M.find(".fr-list-column").each(function(i,o){var a=e(o);0===i?(n=a.outerHeight(),t=a):a.outerHeight()<n&&(n=a.outerHeight(),t=a)}),t}function f(t){void 0===t&&(t=0);for(var n=[],i=R-1;i>=t;i--){var o=M.find(".fr-image-"+i);o.length&&(n.push(o),e('<div id="fr-image-hidden-container">').append(o),M.find(".fr-image-"+i).remove())}return n}function p(e){for(var t=e.length-1;t>=0;t--)h().append(e[t])}function m(e){if(void 0===e&&(e=!0),!x.is(":visible"))return!0;var n=o();if(n!=$){$=n;var i=f();a(),p(i)}var r=t.$win.height(),s=x.find(".fr-modal-wrapper"),l=parseFloat(s.css("margin-top"))+parseFloat(s.css("margin-bottom")),d=parseFloat(s.css("padding-top"))+parseFloat(s.css("padding-bottom")),u=parseFloat(s.css("border-top-width")),h=s.find("h4").outerHeight();L.height(Math.min(M.outerHeight(),r-l-d-h-u)),e&&c()}function g(e){var t={},n=e.data();for(var i in n)n.hasOwnProperty(i)&&"url"!=i&&"tag"!=i&&(t[i]=n[i]);return t}function v(n){var o=e(n.currentTarget).siblings("img"),a=x.data("instance")||t;if(i(),a.image.showProgressBar(),V)V.trigger("click");else{a.events.focus(!0),a.selection.restore();var r=a.position.getBoundingRect(),s=r.left+r.width/2,l=r.top+r.height;a.popups.setContainer("image.insert",a.$box||e("body")),a.popups.show("image.insert",s,l)}a.image.insert(o.data("url"),!1,g(o),V)}function y(n){var i=e(n.currentTarget).siblings("img"),o=t.language.translate("Are you sure? Image will be deleted.");confirm(o)&&(t.opts.imageManagerDeleteURL?t.events.trigger("imageManager.beforeDeleteImage",[i])!==!1&&(i.parent().addClass("fr-image-deleting"),e.ajax({method:t.opts.imageManagerDeleteMethod,url:t.opts.imageManagerDeleteURL,data:e.extend(e.extend({src:i.attr("src")},g(i)),t.opts.imageManagerDeleteParams),crossDomain:t.opts.requestWithCORS,xhrFields:{withCredentials:t.opts.requestWithCORS},headers:t.opts.requestHeaders}).done(function(e){t.events.trigger("imageManager.imageDeleted",[e]);var n=f(parseInt(i.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);i.parent().remove(),p(n),m(!0)}).fail(function(){var e=this.xhr();b(U,e.response||e.responseText)})):b(W))}function b(n,i){n>=10&&20>n?C.hide():n>=20&&30>n&&e(".fr-image-deleting").removeClass("fr-image-deleting"),t.events.trigger("imageManager.error",[{code:n,message:K[n]},i])}function _(){var e=D.find(".fr-modal-title-line").outerHeight(),t=A.outerHeight();D.toggleClass(".fr-show-tags"),D.hasClass(".fr-show-tags")?(D.css("height",e+t),A.find("a").css("opacity",1)):(D.css("height",e),A.find("a").css("opacity",0))}function w(){var t=A.find(".fr-selected-tag");t.length>0?(M.find("img").parent().show(),t.each(function(t,n){M.find("img").each(function(t,i){var o=e(i);S(o,n.text)||o.parent().hide()})})):M.find("img").parent().show();var n=f();p(n),c()}function k(n){n.preventDefault();var i=e(n.currentTarget);i.toggleClass("fr-selected-tag"),t.opts.imageManagerToggleTags&&i.siblings("a").removeClass("fr-selected-tag"),w()}function S(e,t){for(var n=e.attr("data-tag").split(","),i=0;i<n.length;i++)if(n[i]==t)return!0;return!1}function E(){C=x.find("#fr-preloader"),M=x.find("#fr-image-list"),L=x.find("#fr-scroller"),A=x.find("#fr-modal-tags"),D=A.parent(),$=o(),a();var n=D.find(".fr-modal-title-line").outerHeight();D.css("height",n),L.css("margin-top",n),t.events.bindClick(x,"i#fr-modal-close",i),t.events.$on(e(t.o_win),"resize",function(){m(!!N)}),t.helpers.isMobile()&&(t.events.bindClick(M,"div.fr-image-container",function(t){x.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),e(t.currentTarget).addClass("fr-mobile-selected")}),x.on(t._mousedown,function(){x.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),t.events.bindClick(M,".fr-insert-img",v),t.events.bindClick(M,".fr-delete-img",y),x.on(t._mousedown+" "+t._mouseup,function(e){e.stopPropagation()}),x.on(t._mousedown,"*",function(){t.events.disableBlur()}),L.on("scroll",c),t.events.bindClick(x,"i#fr-modal-more-"+t.sid,_),t.events.bindClick(A,"a",k)}function T(){return!(!t.$wp&&"IMG"!=t.$el.get(0).tagName)&&void 0}var x,C,M,L,A,D,F,N,I,O,R,$,P=10,H=11,j=12,z=13,B=14,Y=15,U=21,W=22,K={};K[P]="Image cannot be loaded from the passed link.",K[H]="Error during load images request.",K[j]="Missing imageManagerLoadURL option.",K[z]="Parsing load response failed.",K[B]="Missing image thumb.",K[Y]="Missing image URL.",K[U]="Error during delete image request.",K[W]="Missing imageManagerDeleteURL option.";var V;return{require:["image"],_init:T,show:n,hide:i}},!e.FE.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");e.FE.DEFAULTS.imageInsertButtons.push("imageManager"),e.FE.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.imageManager.show()},plugin:"imageManager"}),e.FE.DefineIcon("imageManager",{NAME:"folder"}),e.FE.DefineIcon("imageManagerInsert",{NAME:"plus"}),e.FE.DefineIcon("imageManagerDelete",{NAME:"trash"})});
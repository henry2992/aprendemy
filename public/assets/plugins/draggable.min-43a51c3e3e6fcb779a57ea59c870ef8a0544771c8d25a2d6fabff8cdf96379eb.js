!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";e.extend(e.FE.DEFAULTS,{dragInline:!0}),e.FE.PLUGINS.draggable=function(t){function n(n){return n.target&&"A"==n.target.tagName&&1==n.target.childNodes.length&&"IMG"==n.target.childNodes[0].tagName&&(n.target=n.target.childNodes[0]),e(n.target).hasClass("fr-draggable")?(e(n.target).addClass("fr-dragging"),t.opts.dragInline?t.$el.attr("contenteditable",!0):t.$el.attr("contenteditable",!1),t.opts.toolbarInline&&t.toolbar.hide(),t.undo.canDo()||t.undo.saveStep(),t.browser.msie||t.browser.edge||t.selection.clear(),void n.originalEvent.dataTransfer.setData("text","Froala")):(n.preventDefault(),!1)}function i(e){return!(e&&("HTML"==e.tagName||"BODY"==e.tagName||t.node.isElement(e)))}function o(e,n,i){t.opts.iframe&&(e+=t.$iframe.offset().top,n+=t.$iframe.offset().left),h.offset().top!=e&&h.css("top",e),h.offset().left!=n&&h.css("left",n),h.width()!=i&&h.css("width",i)}function a(n){var a=t.doc.elementFromPoint(n.originalEvent.pageX-t.win.pageXOffset,n.originalEvent.pageY-t.win.pageYOffset);if(!i(a)){for(var r=0,s=a;!i(s)&&s==a&&n.originalEvent.pageY-t.win.pageYOffset-r>0;)r++,s=t.doc.elementFromPoint(n.originalEvent.pageX-t.win.pageXOffset,n.originalEvent.pageY-t.win.pageYOffset-r);(!i(s)||h&&0===t.$el.find(s).length&&s!=h.get(0))&&(s=null);for(var l=0,d=a;!i(d)&&d==a&&n.originalEvent.pageY-t.win.pageYOffset+l<e(t.doc).height();)l++,d=t.doc.elementFromPoint(n.originalEvent.pageX-t.win.pageXOffset,n.originalEvent.pageY-t.win.pageYOffset+l);(!i(d)||h&&0===t.$el.find(d).length&&d!=h.get(0))&&(d=null),a=null==d&&s?s:d&&null==s?d:d&&s?l>r?s:d:null}if(e(a).hasClass("fr-drag-helper"))return!1;if(a&&!t.node.isBlock(a)&&(a=t.node.blockParent(a)),a&&["TD","TH","TR","THEAD","TBODY"].indexOf(a.tagName)>=0&&(a=e(a).parents("table").get(0)),a&&["LI"].indexOf(a.tagName)>=0&&(a=e(a).parents("UL, OL").get(0)),a&&!e(a).hasClass("fr-drag-helper")){h||(e.FE.$draggable_helper||(e.FE.$draggable_helper=e('<div class="fr-drag-helper"></div>')),h=e.FE.$draggable_helper,t.events.on("shared.destroy",function(){h.html("").removeData().remove(),h=null},!0));var c,u=n.originalEvent.pageY;c=u<e(a).offset().top+e(a).outerHeight()/2;var f=e(a),p=0;c||0!==f.next().length?(c||(f=f.next()),"before"==h.data("fr-position")&&f.is(h.data("fr-tag"))||(f.prev().length>0&&(p=parseFloat(f.prev().css("margin-bottom"))||0),p=Math.max(p,parseFloat(f.css("margin-top"))||0),o(f.offset().top-p/2-t.$box.offset().top,f.offset().left-t.win.pageXOffset-t.$box.offset().left,f.width()),h.data("fr-position","before"))):"after"==h.data("fr-position")&&f.is(h.data("fr-tag"))||(p=parseFloat(f.css("margin-bottom"))||0,o(f.offset().top+e(a).height()+p/2-t.$box.offset().top,f.offset().left-t.win.pageXOffset-t.$box.offset().left,f.width()),h.data("fr-position","after")),h.data("fr-tag",f),h.addClass("fr-visible"),h.appendTo(t.$box)}else h&&t.$box.find(h).length>0&&h.removeClass("fr-visible")}function r(e){e.originalEvent.dataTransfer.dropEffect="move",t.opts.dragInline?d()||!t.browser.msie&&!t.browser.edge||e.preventDefault():(e.preventDefault(),a(e))}function s(e){e.originalEvent.dataTransfer.dropEffect="move",t.opts.dragInline||e.preventDefault()}function l(e){t.$el.attr("contenteditable",!0);var n=t.$el.find(".fr-dragging");h&&h.hasClass("fr-visible")&&t.$box.find(h).length?c(e):n.length&&(e.preventDefault(),e.stopPropagation(),h&&!h.hasClass("fr-visible")&&n.removeClass("fr-dragging")),h&&t.$box.find(h).length&&h.removeClass("fr-visible")}function d(){for(var t=null,n=0;n<e.FE.INSTANCES.length;n++)if(t=e.FE.INSTANCES[n].$el.find(".fr-dragging"),t.length)return t.get(0)}function c(n){for(var i,o,a=0;a<e.FE.INSTANCES.length;a++)if(i=e.FE.INSTANCES[a].$el.find(".fr-dragging"),i.length){o=e.FE.INSTANCES[a];break}if(i.length){if(n.preventDefault(),n.stopPropagation(),h&&h.hasClass("fr-visible")&&t.$box.find(h).length)h.data("fr-tag")[h.data("fr-position")]('<span class="fr-marker"></span>'),h.removeClass("fr-visible");else{var r=t.markers.insertAtPoint(n.originalEvent);if(r===!1)return!1}t.popups.hideAll(),o==t||t.undo.canDo()||t.undo.saveStep();var s=i;if(i.parent().is("A")&&(s=i.parent()),t.core.isEmpty())t.$el.html(s);else{var l=t.$el.find(".fr-marker");l.replaceWith(s),i.after(e.FE.MARKERS),t.selection.restore()}return i.removeClass("fr-dragging"),t.$el.find(t.html.emptyBlockTagsQuery()).not("TD, TH, LI, .fr-inner").remove(),t.html.wrap(),t.html.fillEmptyBlocks(),t.undo.saveStep(),t.opts.iframe&&t.size.syncIframe(),o!=t&&(o.popups.hideAll(),o.$el.find(t.html.emptyBlockTagsQuery()).not("TD, TH, LI, .fr-inner").remove(),o.html.wrap(),o.html.fillEmptyBlocks(),o.undo.saveStep(),o.events.trigger("element.dropped"),o.opts.iframe&&o.size.syncIframe()),t.events.trigger("element.dropped",[i]),!1}}function u(){t.opts.enter==e.FE.ENTER_BR&&(t.opts.dragInline=!0),t.events.on("dragstart",n,!0),t.events.on("dragover",r,!0),t.events.on("dragenter",s,!0),t.events.on("document.dragend",l,!0),t.events.on("document.drop",l,!0),t.events.on("drop",c,!0),t.events.on("html.get",function(e){return e=e.replace(/<(div)((?:[\w\W]*?))class="([\w\W]*?)fr-drag-helper([\w\W]*?)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/(div)>/g,"")})}var h;return{_init:u}}});
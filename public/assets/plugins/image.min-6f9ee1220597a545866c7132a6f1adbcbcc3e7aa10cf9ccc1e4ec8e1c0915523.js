!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";e.extend(e.FE.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),e.extend(e.FE.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageRemove","|","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUploadURL:"https://i.froala.com/upload",imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","svg+xml"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1}),e.FE.PLUGINS.image=function(t){function n(){var e=t.popups.get("image.insert"),n=e.find(".fr-image-by-url-layer input");n.val(""),ge&&n.val(ge.attr("src")),n.trigger("change")}function i(){var e=t.$tb.find('.fr-command[data-cmd="insertImage"]'),n=t.popups.get("image.insert");if(n||(n=$()),v(),!n.hasClass("fr-active"))if(t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",t.$tb),e.is(":visible")){var i=e.offset().left+e.outerWidth()/2,o=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("image.insert",i,o,e.outerHeight())}else t.position.forSelection(n),t.popups.show("image.insert")}function o(){var n=t.popups.get("image.edit");n||(n=m()),t.popups.setContainer("image.edit",e(t.opts.scrollableContainer)),t.popups.refresh("image.edit");var i=ge.offset().left+ge.outerWidth()/2,o=ge.offset().top+ge.outerHeight();t.popups.show("image.edit",i,o,ge.outerHeight())}function a(){v()}function r(e){if(!e.hasClass("fr-dii")&&!e.hasClass("fr-dib")){var n=e.css("float");e.css("float","none"),"block"==e.css("display")?(e.css("float",n),t.opts.imageEditButtons.indexOf("imageAlign")>=0&&(0===parseInt(e.css("margin-left"),10)&&(e.attr("style")||"").indexOf("margin-right: auto")>=0?e.addClass("fr-fil"):0===parseInt(e.css("margin-right"),10)&&(e.attr("style")||"").indexOf("margin-left: auto")>=0&&e.addClass("fr-fir")),e.addClass("fr-dib")):(e.css("float",n),t.opts.imageEditButtons.indexOf("imageAlign")>=0&&("left"==e.css("float")?e.addClass("fr-fil"):"right"==e.css("float")&&e.addClass("fr-fir")),e.addClass("fr-dii")),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align","")}}function s(){for(var n="IMG"==t.$el.get(0).tagName?[t.$el.get(0)]:t.$el.get(0).querySelectorAll("img"),i=0;i<n.length;i++){var o=e(n[i]);(t.opts.imageEditButtons.indexOf("imageAlign")>=0||t.opts.imageEditButtons.indexOf("imageDisplay")>=0)&&r(o),o.attr("width")&&(o.css("width",o.width()),o.removeAttr("width")),t.opts.imageTextNear||o.removeClass("fr-dii").addClass("fr-dib"),t.opts.iframe&&o.on("load",t.size.syncIframe)}}function l(){var n,i=Array.prototype.slice.call(t.$el.get(0).querySelectorAll("img")),o=[];for(n=0;n<i.length;n++)o.push(i[n].getAttribute("src")),e(i[n]).toggleClass("fr-draggable",t.opts.imageMove),""===i[n].className&&i[n].removeAttribute("class"),""===i[n].getAttribute("style")&&i[n].removeAttribute("style");if(Le)for(n=0;n<Le.length;n++)o.indexOf(Le[n].getAttribute("src"))<0&&t.events.trigger("image.removed",[e(Le[n])]);Le=i}function d(){ve||q();var n=t.$wp||e(t.opts.scrollableContainer);n.append(ve),ve.data("instance",t);var i=n.scrollTop()-("static"!=n.css("position")?n.offset().top:0),o=n.scrollLeft()-("static"!=n.css("position")?n.offset().left:0);o-=t.helpers.getPX(n.css("border-left-width")),i-=t.helpers.getPX(n.css("border-top-width")),ve.css("top",(t.opts.iframe?ge.offset().top:ge.offset().top+i)-1).css("left",(t.opts.iframe?ge.offset().left:ge.offset().left+o)-1).css("width",ge.get(0).getBoundingClientRect().width).css("height",ge.get(0).getBoundingClientRect().height).addClass("fr-active")}function c(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function u(n){if(!t.core.sameInstance(ve))return!0;if(n.preventDefault(),n.stopPropagation(),t.$el.find("img.fr-error").left)return!1;t.undo.canDo()||t.undo.saveStep(),ye=e(this),ye.data("start-x",n.pageX||n.originalEvent.touches[0].pageX),ye.data("start-width",ge.width()),ye.data("start-height",ge.height());var i=ge.width();if(t.opts.imageResizeWithPercent){var o=ge.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.$el.get(0);ge.css("width",(i/e(o).outerWidth()*100).toFixed(2)+"%")}else ge.css("width",i);be.show(),t.popups.hideAll(),oe()}function h(n){if(!t.core.sameInstance(ve))return!0;if(ye&&ge){if(n.preventDefault(),t.$el.find("img.fr-error").left)return!1;var i=n.pageX||(n.originalEvent.touches?n.originalEvent.touches[0].pageX:null);if(!i)return!1;var o=ye.data("start-x"),a=i-o,r=ye.data("start-width");if((ye.hasClass("fr-hnw")||ye.hasClass("fr-hsw"))&&(a=0-a),t.opts.imageResizeWithPercent){var s=ge.parentsUntil(t.$el,t.html.blockTagsQuery()).get(0)||t.$el.get(0);r=((r+a)/e(s).outerWidth()*100).toFixed(2),t.opts.imageRoundPercent&&(r=Math.round(r)),ge.css("width",r+"%"),ge.css("height","").removeAttr("height")}else r+a>=t.opts.imageMinWidth&&ge.css("width",r+a),ge.css("height",ye.data("start-height")*ge.width()/ye.data("start-width"));d(),t.events.trigger("image.resize",[pe()])}}function f(e){if(!t.core.sameInstance(ve))return!0;if(ye&&ge){if(e&&e.stopPropagation(),t.$el.find("img.fr-error").left)return!1;ye=null,be.hide(),d(),o(),t.undo.saveStep(),t.events.trigger("image.resizeEnd",[pe()])}}function p(e,n){t.edit.on(),ge&&ge.addClass("fr-error"),b(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("image.error",[{code:e,message:Me[e]},n])}function m(e){if(e)return t.$wp&&t.events.$on(t.$wp,"scroll",function(){ge&&t.popups.isVisible("image.edit")&&o()}),!0;var n="";t.opts.imageEditButtons.length>0&&(n+='<div class="fr-buttons">',n+=t.button.buildList(t.opts.imageEditButtons),n+="</div>");var i={buttons:n},a=t.popups.create("image.edit",i);return a}function g(n){var i=t.popups.get("image.insert");if(i||(i=$()),i.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),i.find(".fr-image-progress-bar-layer").addClass("fr-active"),i.find(".fr-buttons").hide(),ge){t.popups.setContainer("image.insert",e(t.opts.scrollableContainer));var o=ge.offset().left+ge.width()/2,a=ge.offset().top+ge.height();t.popups.show("image.insert",o,a,ge.outerHeight())}"undefined"==typeof n&&y("Uploading",0)}function v(e){var n=t.popups.get("image.insert");n&&(n.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),n.find(".fr-image-progress-bar-layer").removeClass("fr-active"),n.find(".fr-buttons").show(),(e||t.$el.find("img.fr-error").length)&&(t.events.focus(),t.$el.find("img.fr-error").remove(),t.undo.saveStep(),t.undo.run(),t.undo.dropRedo()))}function y(e,n){var i=t.popups.get("image.insert");if(i){var o=i.find(".fr-image-progress-bar-layer");o.find("h3").text(e+(n?" "+n+"%":"")),o.removeClass("fr-error"),n?(o.find("div").removeClass("fr-indeterminate"),o.find("div > span").css("width",n+"%")):o.find("div").addClass("fr-indeterminate")}}function b(e){g();var n=t.popups.get("image.insert"),i=n.find(".fr-image-progress-bar-layer");i.addClass("fr-error"),i.find("h3").text(e)}function _(){var e=t.popups.get("image.insert"),n=e.find(".fr-image-by-url-layer input");n.val().length>0&&(g(),y("Loading image"),S(n.val(),!0,[],ge),n.val(""),n.blur())}function w(e){te.call(e.get(0))}function k(){var n=e(this);t.popups.hide("image.insert"),n.removeClass("fr-uploading"),n.next().is("br")&&n.next().remove(),w(n),t.events.trigger("image.loaded",[n])}function S(e,n,i,o,a){t.edit.off(),y("Loading image"),n&&(e=t.helpers.sanitizeURL(e));var r=new Image;r.onload=function(){var n,r;if(o){var s=o.data("fr-old-src");t.$wp?(n=o.clone().removeData("fr-old-src").removeClass("fr-uploading"),n.off("load"),s&&o.attr("src",s),o.replaceWith(n)):n=o;for(var d=n.get(0).attributes,c=0;c<d.length;c++){var u=d[c];0===u.nodeName.indexOf("data-")&&n.removeAttr(u.nodeName)}if("undefined"!=typeof i)for(r in i)i.hasOwnProperty(r)&&"link"!=r&&n.attr("data-"+r,i[r]);n.on("load",k),n.attr("src",e),t.edit.on(),l(),t.undo.saveStep(),t.events.trigger(s?"image.replaced":"image.inserted",[n,a])}else n=L(e,i,k),l(),t.undo.saveStep(),t.events.trigger("image.inserted",[n,a])},r.onerror=function(){p(we)},r.src=e}function E(n){try{if(t.events.trigger("image.uploaded",[n],!0)===!1)return t.edit.on(),!1;var i=e.parseJSON(n);return i.link?i:(p(ke,n),!1)}catch(e){return p(Ee,n),!1}}function T(n){try{var i=e(n).find("Location").text(),o=e(n).find("Key").text();return t.events.trigger("image.uploadedToS3",[i,o,n],!0)===!1?(t.edit.on(),!1):i}catch(e){return p(Ee,n),!1}}function x(e){y("Loading image");var n=this.status,i=this.response,o=this.responseXML,a=this.responseText;try{if(t.opts.imageUploadToS3)if(201==n){var r=T(o);r&&S(r,!1,[],e,i||o)}else p(Ee,i||o);else if(n>=200&&300>n){var s=E(a);s&&S(s.link,!1,s,e,i||a)}else p(Se,i||a)}catch(e){p(Ee,i||a)}}function C(){p(Ee,this.response||this.responseText||this.responseXML)}function M(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;y("Uploading",t)}}function L(n,i,o){var a,r="";if(i&&"undefined"!=typeof i)for(a in i)i.hasOwnProperty(a)&&"link"!=a&&(r+=" data-"+a+'="'+i[a]+'"');var s=t.opts.imageDefaultWidth;s&&"auto"!=s&&(s+=t.opts.imageResizeWithPercent?"%":"px");var l=e('<img class="'+(t.opts.imageDefaultDisplay?"fr-di"+t.opts.imageDefaultDisplay[0]:"")+(t.opts.imageDefaultAlign&&"center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:"")+'" src="'+n+'"'+r+(s?' style="width: '+s+';"':"")+">");l.on("load",o),t.edit.on(),t.events.focus(!0),t.selection.restore(),t.undo.saveStep(),t.opts.imageSplitHTML?t.markers.split():t.markers.insert();var d=t.$el.find(".fr-marker");return d.replaceWith(l),t.html.wrap(),t.selection.clear(),l}function A(){t.edit.on(),v(!0)}function D(n,i,o){function a(){var o=e(this);o.off("load"),o.addClass("fr-uploading"),o.next().is("br")&&o.next().remove(),t.placeholder.refresh(),o.is(ge)||w(o),d(),g(),t.edit.off(),n.onload=function(){x.call(n,o)},n.onerror=C,n.upload.onprogress=M,n.onabort=A,o.off("abortUpload").on("abortUpload",function(){4!=n.readyState&&n.abort()}),n.send(i)}var r,s=new FileReader;s.addEventListener("load",function(){var e=s.result;if(s.result.indexOf("svg+xml")<0){for(var n=atob(s.result.split(",")[1]),i=[],o=0;o<n.length;o++)i.push(n.charCodeAt(o));e=window.URL.createObjectURL(new Blob([new Uint8Array(i)],{type:"image/jpeg"}))}ge?(ge.on("load",a),t.edit.on(),t.undo.saveStep(),ge.data("fr-old-src",ge.attr("src")),ge.attr("src",e)):r=L(e,null,a)},!1),s.readAsDataURL(o)}function F(e){if(t.events.trigger("image.beforeUpload",[e])===!1)return!1;if("undefined"!=typeof e&&e.length>0){var n=e[0];if(n.size>t.opts.imageMaxSize)return p(Te),!1;if(t.opts.imageAllowedTypes.indexOf(n.type.replace(/image\//g,""))<0)return p(xe),!1;var i;if(t.drag_support.formdata&&(i=t.drag_support.formdata?new FormData:null),i){var o;if(t.opts.imageUploadToS3!==!1){i.append("key",t.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(n.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",n.type);for(o in t.opts.imageUploadToS3.params)t.opts.imageUploadToS3.params.hasOwnProperty(o)&&i.append(o,t.opts.imageUploadToS3.params[o])}for(o in t.opts.imageUploadParams)t.opts.imageUploadParams.hasOwnProperty(o)&&i.append(o,t.opts.imageUploadParams[o]);i.append(t.opts.imageUploadParam,n);var a=t.opts.imageUploadURL;t.opts.imageUploadToS3&&(a="https://"+t.opts.imageUploadToS3.region+".amazonaws.com/"+t.opts.imageUploadToS3.bucket);var r=t.core.getXHR(a,t.opts.imageUploadMethod);D(r,i,n)}}}function N(n){t.events.$on(n,"dragover dragenter",".fr-image-upload-layer",function(){return e(this).addClass("fr-drop"),!1}),t.events.$on(n,"dragleave dragend",".fr-image-upload-layer",function(){return e(this).removeClass("fr-drop"),!1}),t.events.$on(n,"drop",".fr-image-upload-layer",function(i){i.preventDefault(),i.stopPropagation(),e(this).removeClass("fr-drop");var o=i.originalEvent.dataTransfer;if(o&&o.files){var a=n.data("instance")||t;a.events.disableBlur(),a.image.upload(o.files),a.events.enableBlur()}}),t.events.$on(n,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var i=n.data("instance")||t;i.events.disableBlur(),n.find("input:focus").blur(),i.events.enableBlur(),i.image.upload(this.files)}e(this).val("")})}function I(n){var i=n.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var o=i.files[0];if(o&&o.type&&t.opts.imageAllowedTypes.indexOf(o.type.replace(/image\//g,""))>=0){t.markers.remove(),t.markers.insertAtPoint(n.originalEvent),t.$el.find(".fr-marker").replaceWith(e.FE.MARKERS),t.popups.hideAll();var a=t.popups.get("image.insert");return a||(a=$()),t.popups.setContainer("image.insert",e(t.opts.scrollableContainer)),t.popups.show("image.insert",n.originalEvent.pageX,n.originalEvent.pageY),g(),F(i.files),n.preventDefault(),n.stopPropagation(),!1}}}function O(){var n,i,o=t.selection.ranges(0);o.collapsed&&o.startContainer.nodeType==Node.ELEMENT_NODE&&(o.startContainer.childNodes.length==o.startOffset?(n=o.startContainer.childNodes[o.startOffset-1],n&&"IMG"==n.tagName&&"block"==e(n).css("display")&&(i=t.node.blockParent(n),i&&t.html.defaultTag()?i.nextSibling||(["TD","TH"].indexOf(i.tagName)<0?e(i).after("<"+t.html.defaultTag()+"><br>"+e.FE.MARKERS+"</"+t.html.defaultTag()+">"):e(img).after("<br>"+e.FE.MARKERS),t.selection.restore()):i||(e(n).after("<br>"+e.FE.MARKERS),t.selection.restore()))):0===o.startOffset&&o.startContainer.childNodes.length>o.startOffset&&(n=o.startContainer.childNodes[o.startOffset],n&&"IMG"==n.tagName&&"block"==e(n).css("display")&&(i=t.node.blockParent(n),i&&t.html.defaultTag()?i.previousSibling||(["TD","TH"].indexOf(i.tagName)<0?e(i).before("<"+t.html.defaultTag()+"><br>"+e.FE.MARKERS+"</"+t.html.defaultTag()+">"):e(img).before("<br>"+e.FE.MARKERS),t.selection.restore()):i||(e(n).before(e.FE.MARKERS+"<br>"),t.selection.restore()))))}function R(){t.events.$on(t.$el,t._mousedown,"IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',function(n){return!!e(this).parents('[contenteditable="false"]:not(.fr-element):not(body)').length||(t.selection.clear(),_e=!0,t.browser.msie&&(t.events.disableBlur(),t.$el.attr("contenteditable",!1)),t.draggable||n.preventDefault(),void n.stopPropagation())}),t.events.$on(t.$el,t._mouseup,"IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',function(n){return!!e(this).parents('[contenteditable="false"]:not(.fr-element):not(body)').length||void(_e&&(_e=!1,n.stopPropagation(),t.browser.msie&&(t.$el.attr("contenteditable",!0),t.events.enableBlur())))}),t.events.on("keyup",function(n){if(n.shiftKey&&""===t.selection.text().replace(/\n/g,"")){var i=t.selection.element(),o=t.selection.endElement();i&&"IMG"==i.tagName?w(e(i)):o&&"IMG"==o.tagName&&w(e(o))}},!0),t.events.on("drop",I),t.events.on("mousedown window.mousedown",ie),t.events.on("window.touchmove",oe),t.events.on("mouseup window.mouseup",function(){return ge?(ne(),!1):void 0}),t.events.on("commands.mousedown",function(e){e.parents(".fr-toolbar").length>0&&ne()}),t.events.on("mouseup",O),t.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){_e=!1,ne(!0)})}function $(e){if(e)return t.popups.onRefresh("image.insert",n),t.popups.onHide("image.insert",a),!0;var i,o="";t.opts.imageInsertButtons.length>1&&(o='<div class="fr-buttons">'+t.button.buildList(t.opts.imageInsertButtons)+"</div>");var r=t.opts.imageInsertButtons.indexOf("imageUpload"),s=t.opts.imageInsertButtons.indexOf("imageByURL"),l="";r>=0&&(i=" fr-active",s>=0&&r>s&&(i=""),l='<div class="fr-image-upload-layer'+i+' fr-layer" id="fr-image-upload-layer-'+t.id+'"><strong>'+t.language.translate("Drop image")+"</strong><br>("+t.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/'+t.opts.imageAllowedTypes.join(", image/").toLowerCase()+'" tabIndex="-1"></div></div>');var d="";s>=0&&(i=" fr-active",r>=0&&s>r&&(i=""),d='<div class="fr-image-by-url-layer'+i+' fr-layer" id="fr-image-by-url-layer-'+t.id+'"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2">'+t.language.translate("Insert")+"</button></div></div>");var c='<div class="fr-image-progress-bar-layer fr-layer"><h3 class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-back" data-cmd="imageDismissError" tabIndex="2">OK</button></div></div>',u={buttons:o,upload_layer:l,by_url_layer:d,progress_bar:c},h=t.popups.create("image.insert",u);return t.$wp&&t.events.$on(t.$wp,"scroll",function(){ge&&t.popups.isVisible("image.insert")&&ue()}),N(h),h}function P(){if(ge){var e=t.popups.get("image.alt");e.find("input").val(ge.attr("alt")||"").trigger("change")}}function H(){var n=t.popups.get("image.alt");n||(n=j()),v(),t.popups.refresh("image.alt"),t.popups.setContainer("image.alt",e(t.opts.scrollableContainer));var i=ge.offset().left+ge.width()/2,o=ge.offset().top+ge.height();t.popups.show("image.alt",i,o,ge.outerHeight())}function j(e){if(e)return t.popups.onRefresh("image.alt",P),!0;var n="";n='<div class="fr-buttons">'+t.button.buildList(t.opts.imageAltButtons)+"</div>";var i="";i='<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+t.id+'"><div class="fr-input-line"><input type="text" placeholder="'+t.language.translate("Alternate Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2">'+t.language.translate("Update")+"</button></div></div>";var o={buttons:n,alt_layer:i},a=t.popups.create("image.alt",o);return t.$wp&&t.events.$on(t.$wp,"scroll.image-alt",function(){ge&&t.popups.isVisible("image.alt")&&H()}),a}function z(e){if(ge){var n=t.popups.get("image.alt");ge.attr("alt",e||n.find("input").val()||""),n.find("input:focus").blur(),w(ge)}}function B(){if(ge){var e=t.popups.get("image.size");e.find('input[name="width"]').val(ge.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(ge.get(0).style.height).trigger("change")}}function Y(){var n=t.popups.get("image.size");n||(n=U()),v(),t.popups.refresh("image.size"),t.popups.setContainer("image.size",e(t.opts.scrollableContainer));var i=ge.offset().left+ge.width()/2,o=ge.offset().top+ge.height();t.popups.show("image.size",i,o,ge.outerHeight())}function U(e){if(e)return t.popups.onRefresh("image.size",B),!0;var n="";n='<div class="fr-buttons">'+t.button.buildList(t.opts.imageSizeButtons)+"</div>";var i="";i='<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+t.id+'"><div class="fr-image-group"><div class="fr-input-line"><input type="text" name="width" placeholder="'+t.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input type="text" name="height" placeholder="'+t.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2">'+t.language.translate("Update")+"</button></div></div>";var o={buttons:n,size_layer:i},a=t.popups.create("image.size",o);return t.$wp&&t.events.$on(t.$wp,"scroll.image-size",function(){ge&&t.popups.isVisible("image.size")&&Y()}),a}function W(e,n){if(ge){var i=t.popups.get("image.size");ge.css("width",e||i.find('input[name="width"]').val()),ge.css("height",n||i.find('input[name="height"]').val()),i.find("input:focus").blur(),w(ge)}}function K(e){var n,i,o=t.popups.get("image.insert");if(ge||t.opts.toolbarInline)ge&&(i=ge.offset().top+ge.outerHeight());else{var a=t.$tb.find('.fr-command[data-cmd="insertImage"]');n=a.offset().left+a.outerWidth()/2,i=a.offset().top+(t.opts.toolbarBottom?10:a.outerHeight()-10)}!ge&&t.opts.toolbarInline&&(i=o.offset().top-t.helpers.getPX(o.css("margin-top")),o.hasClass("fr-above")&&(i+=o.outerHeight())),o.find(".fr-layer").removeClass("fr-active"),o.find(".fr-"+e+"-layer").addClass("fr-active"),t.popups.show("image.insert",n,i,ge?ge.outerHeight():0)}function V(e){var n=t.popups.get("image.insert");n.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active")}function G(e){var n=t.popups.get("image.insert");n.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active")}function q(){var n;t.shared.$image_resizer?(ve=t.shared.$image_resizer,be=t.shared.$img_overlay,t.events.on("destroy",function(){ve.removeClass("fr-active").appendTo(e("body"))},!0)):(t.shared.$image_resizer=e('<div class="fr-image-resizer"></div>'),ve=t.shared.$image_resizer,t.events.$on(ve,"mousedown",function(e){e.stopPropagation()},!0),t.opts.imageResize&&(ve.append(c("nw")+c("ne")+c("sw")+c("se")),t.shared.$img_overlay=e('<div class="fr-image-overlay"></div>'),be=t.shared.$img_overlay,n=ve.get(0).ownerDocument,e(n).find("body").append(be))),t.events.on("shared.destroy",function(){ve.html("").removeData().remove(),ve=null,t.opts.imageResize&&(be.remove(),be=null)},!0),t.helpers.isMobile()||t.events.$on(e(t.o_win),"resize",function(){ge&&!ge.hasClass("fr-uploading")?ne(!0):ge&&(d(),ue(),g(!1))}),t.opts.imageResize&&(n=ve.get(0).ownerDocument,t.events.$on(ve,t._mousedown,".fr-handler",u),t.events.$on(e(n),t._mousemove,h),t.events.$on(e(n.defaultView||n.parentWindow),t._mouseup,f),t.events.$on(be,"mouseleave",f))}function X(n){n=n||ge,n&&t.events.trigger("image.beforeRemove",[n])!==!1&&(t.popups.hideAll(),ne(!0),n.get(0)==t.$el.get(0)?n.removeAttr("src"):("A"==n.get(0).parentNode.tagName?(t.selection.setBefore(n.get(0).parentNode)||t.selection.setAfter(n.get(0).parentNode)||n.parent().after(e.FE.MARKERS),e(n.get(0).parentNode).remove()):(t.selection.setBefore(n.get(0))||t.selection.setAfter(n.get(0))||n.after(e.FE.MARKERS),n.remove()),t.html.fillEmptyBlocks(),t.selection.restore()),t.undo.saveStep())}function Q(){if(R(),"IMG"==t.$el.get(0).tagName&&t.$el.addClass("fr-view"),t.events.$on(t.$el,t.helpers.isMobile()&&!t.helpers.isWindowsPhone()?"touchend":"click","IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',te),t.helpers.isMobile()&&(t.events.$on(t.$el,"touchstart","IMG"==t.$el.get(0).tagName?null:'img:not([contenteditable="false"])',function(){Ae=!1}),t.events.$on(t.$el,"touchmove",function(){Ae=!0})),t.events.on("window.keydown keydown",function(n){var i=n.which;if(ge&&(i==e.FE.KEYCODE.BACKSPACE||i==e.FE.KEYCODE.DELETE))return n.preventDefault(),n.stopPropagation(),X(),!1;if(ge&&i==e.FE.KEYCODE.ESC){var o=ge;return ne(!0),t.selection.setAfter(o.get(0)),t.selection.restore(),n.preventDefault(),!1}return ge&&!t.keys.ctrlKey(n)?(n.preventDefault(),!1):void 0},!0),t.events.on("window.cut window.copy",function(n){ge&&(he(),e.FE.copied_text="\n",e.FE.copied_html=ge.get(0).outerHTML,"copy"==n.type?setTimeout(function(){w(ge)}):(ne(!0),t.undo.saveStep(),setTimeout(function(){t.undo.saveStep()},0)))},!0),t.events.$on(e(t.o_win),"keydown",function(t){var n=t.which;return ge&&n==e.FE.KEYCODE.BACKSPACE?(t.preventDefault(),!1):void 0}),t.events.$on(t.$win,"keydown",function(t){var n=t.which;ge&&ge.hasClass("fr-uploading")&&n==e.FE.KEYCODE.ESC&&ge.trigger("abortUpload")}),t.events.on("destroy",function(){ge&&ge.hasClass("fr-uploading")&&ge.trigger("abortUpload")}),t.events.on("paste.before",Z),t.events.on("paste.beforeCleanup",ee),t.events.on("paste.after",J),t.events.on("html.set",s),t.events.on("html.inserted",s),s(),t.events.on("destroy",function(){Le=[]}),t.events.on("html.get",function(e){return e=e.replace(/<(img)((?:[\w\W]*?))class="([\w\W]*?)(fr-uploading|fr-error)([\w\W]*?)"((?:[\w\W]*?))>/g,"")}),t.opts.imageOutputSize){var n;t.events.on("html.beforeGet",function(){n=t.$el.get(0).querySelectorAll("img");for(var i=0;i<n.length;i++)n[i].setAttribute("width",e(n[i]).width()),n[i].setAttribute("height",e(n[i]).height())}),t.events.on("html.afterGet",function(){for(var e=0;e<n.length;e++)n[e].removeAttribute("width"),n[e].removeAttribute("height")})}t.opts.iframe&&t.events.on("image.loaded",t.size.syncIframe),t.$wp&&(l(),t.events.on("contentChanged",l)),t.events.$on(e(t.o_win),"orientationchange.image",function(){setTimeout(function(){var e=pe();e&&w(e)},0)}),m(!0),$(!0),U(!0),j(!0),t.events.on("node.remove",function(e){return"IMG"==e.get(0).tagName?(X(e),!1):void 0})}function J(){t.opts.imagePaste?t.$el.find("img[data-fr-image-pasted]").each(function(n,i){if(t.opts.imagePasteProcess){var a=t.opts.imageDefaultWidth;a&&"auto"!=a&&(a+=t.opts.imageResizeWithPercent?"%":"px"),e(i).css("width",a),e(i).removeClass("fr-dii fr-dib fr-fir fr-fil").addClass((t.opts.imageDefaultDisplay?"fr-di"+t.opts.imageDefaultDisplay[0]:"")+(t.opts.imageDefaultAlign&&"center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:""))}if(0===i.src.indexOf("data:")){if(t.events.trigger("image.beforePasteUpload",[i])===!1)return!1;ge=e(i),d(),o(),ue(),g(),t.edit.off();for(var r=atob(e(i).attr("src").split(",")[1]),s=[],l=0;l<r.length;l++)s.push(r.charCodeAt(l));var c=new Blob([new Uint8Array(s)],{type:"image/jpeg"});F([c]),e(i).removeAttr("data-fr-image-pasted")}else 0!==i.src.indexOf("http")?(t.selection.save(),e(i).remove(),t.selection.restore()):e(i).removeAttr("data-fr-image-pasted")}):t.$el.find("img[data-fr-image-pasted]").remove()}function Z(e){if(e&&e.clipboardData&&e.clipboardData.items&&e.clipboardData.items[0]){var n=e.clipboardData.items[0].getAsFile();if(n){var i=new FileReader;return i.onload=function(e){var n=e.target.result,i=t.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=t.opts.imageResizeWithPercent?"%":"px"),t.html.insert('<img data-fr-image-pasted="true" class="'+(t.opts.imageDefaultDisplay?"fr-di"+t.opts.imageDefaultDisplay[0]:"")+(t.opts.imageDefaultAlign&&"center"!=t.opts.imageDefaultAlign?" fr-fi"+t.opts.imageDefaultAlign[0]:"")+'" src="'+n+'"'+(i?' style="width: '+i+';"':"")+">"),t.events.trigger("paste.after")},i.readAsDataURL(n),!1}}}function ee(e){return e=e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function te(n){if(e(this).parents('[contenteditable="false"]:not(.fr-element):not(body)').length)return!0;if(n&&"touchend"==n.type&&Ae)return!0;if(n&&t.edit.isDisabled())return n.stopPropagation(),n.preventDefault(),!1;for(var i=0;i<e.FE.INSTANCES.length;i++)e.FE.INSTANCES[i]!=t&&e.FE.INSTANCES[i].events.trigger("image.hideResizer");t.toolbar.disable(),n&&(n.stopPropagation(),n.preventDefault()),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur()),t.opts.iframe&&t.size.syncIframe(),ge=e(this),he(),d(),o(),t.selection.clear(),t.button.bulkRefresh(),t.events.trigger("video.hideResizer")}function ne(e){ge&&(ae()||e===!0)&&(t.toolbar.enable(),ve.removeClass("fr-active"),t.popups.hide("image.edit"),ge=null,oe())}function ie(){De=!0}function oe(){De=!1}function ae(){return De}function re(e){ge.removeClass("fr-fir fr-fil"),"left"==e?ge.addClass("fr-fil"):"right"==e&&ge.addClass("fr-fir"),d(),o()}function se(e){ge&&(ge.hasClass("fr-fil")?e.find("> *:first").replaceWith(t.icon.create("align-left")):ge.hasClass("fr-fir")?e.find("> *:first").replaceWith(t.icon.create("align-right")):e.find("> *:first").replaceWith(t.icon.create("align-justify")))}function le(e,t){if(ge){var n="justify";ge.hasClass("fr-fil")?n="left":ge.hasClass("fr-fir")&&(n="right"),t.find('.fr-command[data-param1="'+n+'"]').addClass("fr-active")}}function de(e){ge.removeClass("fr-dii fr-dib"),"inline"==e?ge.addClass("fr-dii"):"block"==e&&ge.addClass("fr-dib"),d(),o()}function ce(e,t){var n="block";ge.hasClass("fr-dii")&&(n="inline"),t.find('.fr-command[data-param1="'+n+'"]').addClass("fr-active")}function ue(){var n=t.popups.get("image.insert");n||(n=$()),t.popups.isVisible("image.insert")||(v(),t.popups.refresh("image.insert"),t.popups.setContainer("image.insert",e(t.opts.scrollableContainer)));var i=ge.offset().left+ge.width()/2,o=ge.offset().top+ge.height();t.popups.show("image.insert",i,o,ge.outerHeight())}function he(){if(ge){t.selection.clear();var e=t.doc.createRange();e.selectNode(ge.get(0));var n=t.selection.get();n.addRange(e)}}function fe(){ge?(e(".fr-popup input:focus").blur(),w(ge)):(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("image.insert"),t.toolbar.showInline())}function pe(){return ge}function me(e,n,i){if("undefined"==typeof n&&(n=t.opts.imageStyles),"undefined"==typeof i&&(i=t.opts.imageMultipleStyles),!ge)return!1;if(!i){var o=Object.keys(n);o.splice(o.indexOf(e),1),ge.removeClass(o.join(" "))}ge.toggleClass(e),w(ge)}var ge,ve,ye,be,_e=!1,we=1,ke=2,Se=3,Ee=4,Te=5,xe=6,Ce=7,Me={};Me[we]="Image cannot be loaded from the passed link.",Me[ke]="No link in upload response.",Me[Se]="Error during file upload.",Me[Ee]="Parsing response failed.",Me[Te]="File is too large.",Me[xe]="Image file type is invalid.",Me[Ce]="Files can be uploaded only to same domain in IE 8 and IE 9.";var Le,Ae,De=!1;return{_init:Q,showInsertPopup:i,showLayer:K,refreshUploadButton:V,refreshByURLButton:G,upload:F,insertByURL:_,align:re,refreshAlign:se,refreshAlignOnShow:le,display:de,refreshDisplayOnShow:ce,replace:ue,back:fe,get:pe,insert:S,showProgressBar:g,remove:X,hideProgressBar:v,applyStyle:me,showAltPopup:H,showSizePopup:Y,setAlt:z,setSize:W,exitEdit:ne,edit:w}},e.FE.DefineIcon("insertImage",{NAME:"image"}),e.FE.RegisterShortcut(e.FE.KEYCODE.P,"insertImage",null,"P"),e.FE.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),e.FE.DefineIcon("imageUpload",{NAME:"upload"}),e.FE.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.FE.DefineIcon("imageByURL",{NAME:"link"}),e.FE.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.FE.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){var t=this.image.get();t?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),e.FE.DefineIcon("imageDisplay",{NAME:"star"}),e.FE.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.FE.ICONS.align||(e.FE.DefineIcon("align",{NAME:"align-left"}),e.FE.DefineIcon("align-left",{NAME:"align-left"}),e.FE.DefineIcon("align-right",{NAME:"align-right"}),e.FE.DefineIcon("align-center",{NAME:"align-center"}),e.FE.DefineIcon("align-justify",{NAME:"align-justify"})),e.FE.DefineIcon("imageAlign",{NAME:"align-center"}),e.FE.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",justify:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list">',n=e.FE.COMMANDS.imageAlign.options;for(var i in n)n.hasOwnProperty(i)&&(t+='<li><a class="fr-command fr-title" data-cmd="imageAlign" data-param1="'+i+'" title="'+this.language.translate(n[i])+'">'+this.icon.create("align-"+i)+"</a></li>");return t+="</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.FE.DefineIcon("imageReplace",{NAME:"exchange"}),e.FE.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.FE.DefineIcon("imageRemove",{
NAME:"trash"}),e.FE.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.FE.DefineIcon("imageBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){var t=this.image.get();t||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FE.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),e.FE.DefineIcon("imageStyle",{NAME:"magic"}),e.FE.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list">',t=this.opts.imageStyles;for(var n in t)t.hasOwnProperty(n)&&(e+='<li><a class="fr-command" data-cmd="imageStyle" data-param1="'+n+'">'+this.language.translate(t[n])+"</a></li>");return e+="</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(t,n){var i=this.image.get();i&&n.find(".fr-command").each(function(){var t=e(this).data("param1");e(this).toggleClass("fr-active",i.hasClass(t))})}}),e.FE.DefineIcon("imageAlt",{NAME:"info"}),e.FE.RegisterCommand("imageAlt",{undo:!1,focus:!1,title:"Alternate Text",callback:function(){this.image.showAltPopup()}}),e.FE.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.FE.DefineIcon("imageSize",{NAME:"arrows-alt"}),e.FE.RegisterCommand("imageSize",{undo:!1,focus:!1,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.FE.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}})});